# WebRTC Voice Chat

## Алгоритм работы

_Клиент = новый пользователь_

1. Клиент заходит в комнату
2. Сервер отправляет клиенту имена всех подключенных пользователей
3. Клиент для каждого пользователя:
   1. Создает новый `new RTCPeerConnection`
   2. Добавляет localStream
   3. Устанавливает обработчика onaddstream, onremovestream, onicecandidate, oniceconnectionstatechange
   4. Создает оффер `createOffer` и отправляет указанному пользователю через сервер
   5. Устанавливает локальный дескриптор для RTCPeerConnection (offer)
4. Каждый уже подключенный пользователь при получении сообщения `"offer"` от сервера делает:
   1. Последовательность п.3.1 - п.3.3
   2. Создает удаленный дескриптор на основе оффера `new RTCSessionDescription(offer)`
   3. Создает ответ `createAnswer` и отправляет указоннаму пользователю через сервер
   4. Устанавливает локальный дескриптор для RTCPeerConnection (answer)
5. Клиент получив сообщения от сервера `"answer"`, создает удаленный дескриптор `new RTCSessionDescription(answer)`
6. Если все прошло успешно, все пользователи обмениваются "кандидатами"
7. При получении сообщения `"candidate"`, добавляют нового кандидата `addIceCandidate(new RTCIceCandidate(data.candidate))`
8. P2P связь успешно установлена, пользователям становиться доступен новый поток данных.

---

## TO-DO

* [ ] Клиент отправляет `"offer"` не конкретному пользователю, а массиву
* [ ] Сервер делает debounce сообщений `"answer"`
* [ ] Сервер делает debounce сообщений `"candidate"`
